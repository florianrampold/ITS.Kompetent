# ITS.Kompetent

Inbetriebnahme von ITS.kompetent (Unter Vorbehalt)

Um ITS.Kompetent aufzusetzen sind mehrere Schritte notwendig, die im Folgenden erklärt werden. Der vorläufige Prozess der Inbetriebnahme wird im Folgenden beschrieben. Einzelne Schritte können noch verändert werden.
Schritt 0: Klonen des Repositories
Das Repository finden Sie hier:
https://github.com/florianrampold/ITS.Kompetent/tree/main
Achtung: Derzeit ist das Repository noch nicht freigegeben.
Schritt 1: Docker Setup
Zunächst muss auf dem lokalen System, zum Beispiel einer VM oder einem virtuellen Webserver Docker Desktop installiert werden. Die Installation sollte auch docker-compose enthalten. Auf Linux-basierten Systemen ist es außerdem notwendig eine Docker-Gruppe zu erstellen und einen Nutzer mit notwendigen Berechtigungen auf die Docker-Umgebung zu erstellen.
Schritt 2: Konfiguration der Environment Variablen und des Servers
Navigieren Sie in den .env File im Root-Verzeichnis. Ersetzen Sie die Datenbank-Konfigurationen durch eigens gewählte Bezeichnungen.
Zudem muss ein Security Key generiert werden, damit das Backend funktioniert. Dieser kann außerhalb einer Django-Umgebung durch folgenden Befehl erstellt werden. Für die Ausführung wird jedoch eine Python-Installation benötigt:
python -c 'import secrets; print(secrets.token_urlsafe(38))'
Passen Sie zudem den API_URL an. Die sollte in einer Produktionsumgebung die IP-Adresse Ihrer Host-Maschine/Servers sein.
Danach muss die config.js Date im Verzeichnis frontend/src/config.js folgendermaßen angepasst werden:
frontendUrl = "http://192.XXX.X.XX";
backendURL= "http:// 192.XXX.X.XX:8100/api"
Letztlich navigieren Sie zu backend/src/itskompetent/settings.py und fügen Sie die IP-Adresse Ihrer Host-Maschine hier hinzu:
CORS_ALLOWED_ORIGINS = [
"http://192.XXX.X.XX",
]
CSRF_TRUSTED_ORIGINS = [“http://192.XXX.X.XX”]
Schritt 3: Konfiguration von Nginx
Standardmäßig wird ITS.kompetent bereits mit einem Webserver ausgeliefert, der in der Docker-Umgebung läuft. Dies hat den Vorteil, dass auf der Host-Maschine keine separaten Konfigurationen zur Nutzung eines Webservers eingestellt werden müssen. Passen sie folgende Zeilen in der nginx.conf Datei an die IP-Adresse ihres Hosts an:
server_name 192.XXX.X.XX;
proxy_pass http:// 192.XXX.X.XX:8000/;
Optional (Für die Produktionsumgebung im Unternehmen):
Optional können Sie auch die nginx-ssl.conf Datei verwenden, wenn die Verbindung über SSL zugelassen werden soll. Dazu muss durch eine offizielle Zertifizierungsstelle wie CERTBot ein Zertifikat generiert werden.
ssl_certificate /etc/nginx/ssl/nginx.crt; # Path to the SSL certificate
ssl_certificate_key /etc/nginx/ssl/nginx.key; # Path to the SSL certificate key
In diesem Fall müssen Docker-Volumes erstellt werden, die dafür sorgen, dass der nginx-Container Zugriff auf das Zertifikat, sowie dessen Private Key hat. Dazu kann im Root-Verzeichnis die docker-compose.yml folgendermaßen angepasst werden:

# - /etc/letsencrypt/live/yourdomain.com/fullchain.pem:/etc/nginx/ssl/nginx.crt:ro If a real certificate is used generated by certbot this line can be used to copy the certificate from the local machine to the docker container.

      #   - /etc/letsencrypt/live/yourdomain.com/privkey.pem:/etc/nginx/ssl/nginx.key:r If a real private key is used generated by certbot this line can be used to copy the certificate from the local machine to the docker container.

In diesem Fall muss neben Port 80 auch Port 443 freigegeben werden:
ports: - "80:80" # - "443:443" If ssl is used (https connection)
Ersetzen Sie schließlich im DockerFile im Root-Verzeichnis diese Zeile:
COPY nginx/nginx-ssl.conf /etc/nginx/nginx.conf
Nach erfolgreicher Konfiguration von SSL muss Schritt 2 wiederholt werden, in dem http durch https ersetzt wird.
Schritt 4: Konfiguration von RSA Keys (Optional)
In der Default-Einstellung wird eine symmetrische Verschlüsselung des Access Tokens und des Refresh Tokens zur Authentifizierung des Kampagnen-Managers vorgenommen. Dazu wird der SECRET_KEY in backend/src/itskompetent/settings.py als SIGNING_KEY verwendet.
Optional können Sie das RSA-Verfahren verwenden, um diese zu verschlüsseln. Dazu muss in der Umgebung der Host-Maschine ein public key sowie ein private key generiert werden. Konkrete Details zur Umsetzung folgen in der finalen Schritt-für-Schritt-Anleitung.
Schritt 5: Starten der Anwendung:
Führen sie im Root-Verzeichnis (am Speicherort des docker-compose.yml) den folgenden Befehl aus:
docker-compose up –build
Dieser Befehl erstellt initial alle drei Docker-Container und führt Sie aus. Sie können nun in Ihrem Browser die IP-Adresse Ihrer Host-Maschine eingeben und erreichen das Frontend von ITS.kompetent. Navigieren Sie zu der IP-Adresse Ihres Hosts mit zusätzlicher Angabe von Port 8000 erreichen Sie das Backend (zum Beispiel unter: http:// 192.XXX.x.XX:8000/)
Zum Beenden der Anwendung führen Sie folgenden Befehl aus:
docker-compose down
Danach können Sie die Anwendung wieder starten mit:
docker-compose up
